CREATE POLICY "Give access to a file to user with access_key 1io9m69_0" ON storage.objects FOR SELECT TO public USING (((bucket_id = 'photos'::text) AND (EXISTS ( SELECT 1 FROM ((album a JOIN albumphoto ap ON ((a.id = ap.album_id))) JOIN photo p ON ((ap.photo_id = p.id))) WHERE ((a.access_key = ((( SELECT auth.jwt() AS jwt) ->> 'access_key'::text))::uuid) AND (a.is_public = true) AND (p.uri = a.name))))));